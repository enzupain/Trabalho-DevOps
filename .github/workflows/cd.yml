name: Python CD

on:
  push:
    tags:
      - 'v*'  # Push eventos para tags começando com 'v', como v1.0, v20.15.10

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install build setuptools wheel
    - name: Create package files
      run: |
        echo '[build-system]
        requires = ["setuptools>=42", "wheel"]
        build-backend = "setuptools.build_meta"' > pyproject.toml
        
        echo 'from setuptools import setup, find_packages

        setup(
            name="calculadora-python",
            version="${{ github.ref_name }}".replace("v", ""),
            packages=find_packages(),
            python_requires=">=3.6",
        )' > setup.py
        
        mkdir -p calculadora_pkg
        cp calculadora.py matematica_avancada.py calculadora_pkg/
        echo 'from .calculadora import soma, subtracao, multiplicacao, divisao
        from .matematica_avancada import potencia, raiz_quadrada, fatorial
        
        __all__ = [
            "soma", "subtracao", "multiplicacao", "divisao",
            "potencia", "raiz_quadrada", "fatorial"
        ]' > calculadora_pkg/__init__.py
    - name: Build package
      run: python -m build
    - name: Create Release
      id: create_release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          dist/*
        name: Calculadora Python ${{ github.ref_name }}
        body: |
          # Calculadora Python ${{ github.ref_name }}
          
          Essa é uma calculadora Python simples com funções básicas e avançadas.
          
          ## Funcionalidades
          - Operações básicas: soma, subtração, multiplicação, divisão
          - Operações avançadas: potência, raiz quadrada, fatorial
